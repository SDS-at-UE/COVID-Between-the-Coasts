---
title: 'COVID-19:  A Midwestern Reporting Project of WNIN and the University of Evansville'
author: "Minneapolis Zip Code Analysis"
date: "Analysis performed by Maya Frederick, Timmy Miller, Ethan Morlock, Pearl Muensterman, and Darrin Weber, Ph.D."
output: html_document
urlcolor: blue
---
## Data Issues
48209, 48212, 48216, 48217, 48226, 48233, 48242, 48243
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidycensus)
library(tidyverse)
library(leaflet)
library(stringr)
library(sf)
library(tigris)
source("../Scripts/functions.R")
options(tigris_use_cache = TRUE)
variables_2018 <- load_variables(2018, "acs5", cache = TRUE) %>%
  rename(variable = name)
zip_code <- read_csv("../Data/zip_county.csv")
zip_code_det <- zip_code %>% filter(primary_city == "Detroit",
                                      state == "MI")
det_covid <- read_csv("../Data/Detroit Rates.csv",
                      col_types = cols(ZIP_Code = col_character())) %>%
  filter(ZIP_Code %in% zip_code_det$zip)
det_population <- get_acs(geography = "zcta",
                           variable = "B01003_001") %>%
  filter(GEOID %in% zip_code_det$zip)
detroit_covid <- left_join(det_population, det_covid, by = c("GEOID" = "ZIP_Code"))
detroit_covid <- detroit_covid %>% 
  rename(ZIP = GEOID,
         Population = estimate)
detroit_covid <- select(detroit_covid, ZIP, Population, Deaths_per_HundThou, Cases_per_HundThou) %>%
  filter(ZIP != '48209' & ZIP != '48216' & ZIP != '48217' & ZIP != '48226' & ZIP != '48233' & ZIP != '48242' & ZIP != '48243')
```

## Background

The goal of this analysis is to find any connections, if they exist, between demographic data and the outbreak of COVID-19 in the city of Detroit. Demographic data was obtained from the Census Bureau through their 5-year American Community Survey published in 2018 (the most recent 5-year data available). COVID-19 case numbers were obtained from the Detroit Department of Health. (https://codtableau.detroitmi.gov/t/DHD/views/CityofDetroit-PublicCOVIDDashboard/ZIPCodeCaseRatesDashboard?%3AisGuestRedirectFromVizportal=y&%3Aembed=y). 

## Summary

## Analysis

## Occupations (Essential VS. Nonessential)

```{r}
det_occupation <- get_acs(geography = "zcta",
                           table = "C24060") %>% 
  filter(GEOID %in% zip_code_det$zip,
         !variable %in% c("C24060_001"))

det_occupation <- left_join(det_occupation, variables_2018[, 1:2], by = "variable")

det_occupation$label <- as_factor(str_replace(det_occupation$label, ".*!!(.*)", "\\1"))
```

Analyzing Essential Occupations in Detroit.
```{r}
det_occupation_essen <- det_occupation %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("Natural resources, construction, and maintenance occupations",
                      "Production, transportation, and material moving occupations")) %>% 
  mutate(prop_essen = sum(prop)) %>% 
  select(GEOID, prop_essen) %>% 
  distinct(GEOID, prop_essen)

lvls <- det_occupation_essen %>% 
  arrange(prop_essen) %>% 
  pull(GEOID)

det_occupation <- left_join(det_occupation, detroit_covid, by = c("GEOID" = "ZIP"))

ggplot(det_occupation) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Occupations for Each Detroit Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Occupation")
```

The scatterplot shows the correlation between essential jobs and COVID cases. 
```{r}
det_occupation_essen_cor <- left_join(det_occupation_essen, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_occupation_essen_cor) +
  geom_point(aes(x = prop_essen, y = Cases_per_HundThou)) +
  labs(title = "Correlation Between Essential Jobs and COVID Cases",
       x = "Proportion of Essential Workers",
       y = "Case Rate (per 100,000 people)")
```

Test correlation between population with essential jobs to case rate of COVID. 
```{r}
cor.test(det_occupation_essen_cor$prop_essen, det_occupation_essen_cor$Cases_per_HundThou, use = "complete.obs")
```
The correlation between essential jobs and case rate is shown to be -0.297.  This negative correlation means the more essential jobs have a lower rate of contracting COVID. 

The scatterplot shows the correlation between essential jobs and COVID deaths.
```{r}
det_occupation_essen_cor_death <- left_join(det_occupation_essen, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_occupation_essen_cor_death) +
  geom_point(aes(x = prop_essen, y = Deaths_per_HundThou)) +
  labs(title = "Correlation Between Essential Jobs and COVID Deaths",
       x = "Proportion of Essential Workers",
       y = "Death Rate (per 100,000 people)")
```

Test correlation between population with essential jobs to death rate of COVID.
```{r}
cor.test(det_occupation_essen_cor_death$prop_essen, det_occupation_essen_cor_death$Deaths_per_HundThou, use = "complete.obs")
```
The correlation between death rate and COVID is -0.576.  The negative correlation shows the more essential workers are less likely to die when contracting COVID. 

Analyzing Nonessential Occupations in Detroit.
```{r}
det_occupation_nonessen <- det_occupation %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("Management, business, science, and arts occupations",
                      "Service occupations",
                      "Sales and office occupations")) %>% 
  mutate(prop_nonessen = sum(prop)) %>% 
  select(GEOID, prop_nonessen) %>% 
  distinct(GEOID, prop_nonessen)

lvls <- det_occupation_nonessen %>% 
  arrange(prop_nonessen) %>% 
  pull(GEOID)

det_occupation <- left_join(det_occupation, detroit_covid, by = c("GEOID" = "ZIP"))

ggplot(det_occupation) +
  geom_col(aes(GEOID, estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Occupations for Each Detroit Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Occupation")
```

The scatterplot shows the correlation between nonessential jobs and COVID cases for ZIP codes. 
```{r}
det_occupation_nonessen_cor <- left_join(det_occupation_nonessen, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_occupation_nonessen_cor) +
  geom_point(aes(x = prop_nonessen, y = Cases_per_HundThou)) +
  labs(title = "Correlation Between Nonessential Jobs and COVID Cases",
       x = "Proportion of Nonessential Workers",
       y = "Case Rate (per 100,000)")
```

Test correlation between population with nonessential jobs to the case rate of COVID.
```{r}
cor.test(det_occupation_nonessen_cor$prop_nonessen, det_occupation_nonessen_cor$Cases_per_HundThou, use = "complete.obs")
```
The correlation between nonessential jobs and case rate is 0.297.  This means the people with nonessential jobs are more likely to get COVID. 
The scatterplot shows the correlation between nonessential jobs and COVID deaths for ZIP codes.
```{r}
det_occupation_nonessen_cor_death <- left_join(det_occupation_nonessen, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_occupation_nonessen_cor_death) +
  geom_point(aes(x = prop_nonessen, y = Deaths_per_HundThou)) +
  labs(title = "Correlation Between Nonessential Jobs and COVID Deaths",
       x = "Proportion of Nonessential Workers",
       y = "Death Rate (per 100,000)")
```

Test correlation between population with nonessential jobs to the death rate of COVID.
```{r}
cor.test(det_occupation_nonessen_cor_death$prop_nonessen, det_occupation_nonessen_cor_death$Deaths_per_HundThou, use = "complete.obs")
```
The correlation between nonessential workers and death rate is 0.576.  This means nonessential workers who contract COVID are more likely to die from it. 

## Citizenship

```{r}
det_citi <- get_acs(geography = "zcta",
                        table = "B05001") %>% 
  filter(GEOID %in% zip_code_det$zip,
         !variable %in% c("B05001_001"))
det_citi <- left_join(det_citi, variables_2018[, 1:2], by = "variable")
det_citi$label <- as_factor(str_replace(det_citi$label, ".*!!(.*)", "\\1"))
```

Analyzing citizenship in Detroit.
```{r}
det_citi_status <- det_citi %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("Not a U.S. citizen")) %>% 
  mutate(prop_not_citizen = sum(prop)) %>% 
  select(GEOID, prop_not_citizen) %>% 
  distinct(GEOID, prop_not_citizen)

lvls <- det_citi_status %>% 
  arrange(prop_not_citizen) %>% 
  pull(GEOID)

det_citi <- left_join(det_citi, detroit_covid, by = c("GEOID" = "ZIP"))

ggplot(det_citi) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Citizenship Status for Each Detroit Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Citizenship Status")
```

The scatterplot shows the correlation between not being a U.S. citizen and COVID cases in Detroit.
```{r}
det_citi_cor <- left_join(det_citi_status, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_citi_cor) +
  geom_point(aes(x = prop_not_citizen, y = Cases_per_HundThou)) +
  labs(title = "Correlation Between Not Being a U.S. Citizen in Detroit and COVID Cases",
       x = "Proportion of Non U.S. Citizens",
       y = "Case Rate (per 100,000)")
```

Test correlation between percentage of population that is not a U.S. citizen in Detroit to case rate of COVID.
```{r}
cor.test(det_citi_cor$prop_not_citizen, det_citi_cor$Cases_per_HundThou, use = "complete.obs")
```
The correlation between being a non-citizen and case rate is 0.108. 

The scatterplot shows the correlation between not being a U.S. citizen and COVID deaths in Detroit.
```{r}
det_citi_cor_death <- left_join(det_citi_status, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_citi_cor_death) +
  geom_point(aes(x = prop_not_citizen, y = Deaths_per_HundThou)) +
  labs(title = "Correlation Between Not Being a U.S. Citizen in Detroit and COVID Deaths",
       x = "Proportion of Non U.S. Citizens",
       y = "Death Rate (per 100,000)")
```

Test correlation between percentage of population that is not a U.S. citizen in Detroit to death rate of COVID.
```{r}
cor.test(det_citi_cor_death$prop_not_citizen, det_citi_cor_death$Deaths_per_HundThou, use = "complete.obs")
```
The correlation between being a non-citizen and death rate is -0.356. 

## Income 

```{r}
det_income <- get_acs(geography = "zcta",
                        table = "B19101") %>% 
  filter(GEOID %in% zip_code_det$zip,
         !variable %in% c("B19101_001"))
det_income <- left_join(det_income, variables_2018[, 1:2], by = "variable")
det_income$label <- as_factor(str_replace(det_income$label, ".*!!(.*)", "\\1"))
```

Analyzing 100K and over income in Detroit.
```{r}
det_income__sixfig <- det_income %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("$200,000 or more",
                      "$150,000 to $199,999",
                      "$125,000 to $149,999",
                      "$100,000 to $124,999")) %>% 
  mutate(prop_100K = sum(prop)) %>% 
  select(GEOID, prop_100K) %>% 
  distinct(GEOID, prop_100K)

lvls <- det_income__sixfig %>% 
  arrange(prop_100K) %>% 
  pull(GEOID)

det_income <- left_join(det_income, detroit_covid, by = c("GEOID" = "ZIP"))

ggplot(det_income) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Income Status in past year per household for Detroit Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Income Status")
```

The scatterplot shows the correlation betweeen families making a six figure income or more in Detroit and COVID cases. 
```{r}
det_income_sixfig_cor <- left_join(det_income__sixfig, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_income_sixfig_cor) +
  geom_point(aes(x = prop_100K, y = Cases_per_HundThou)) +
  labs(title = "Correlation Between Families Making 100K or More in Detroit and COVID Cases",
       x = "Proportion of Families Making 100K or More",
       y = "Case Rate (per 100,000)")
```

Test correlation between families making six figure incomes or more in Detroit to case rate of COVID. 
```{r}
cor.test(det_income_sixfig_cor$prop_100K, det_income_sixfig_cor$Cases_per_HundThou, use = "complete.obs")
```
The correlation between a six figure income or more in Detroit and case rate is a correlation of 0.082.   

The scatterplot shows the correlation between families making a six figure income or more in Detroit and COVID deaths. 
```{r}
det_income_sixfig_cor_death <- left_join(det_income__sixfig, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_income_sixfig_cor_death) +
  geom_point(aes(x = prop_100K, y = Deaths_per_HundThou)) +
  labs(title = "Correlation Between Families Making 100K or More in Detroit and COVID Deaths",
       x = "Proportion of Families Making 100K or More",
       y = "Death Rate (per 100,000)")
```

Test correlation between families making six figure incomes or more in Detroit to death rate of COVID. 
```{r}
cor.test(det_income_sixfig_cor_death$prop_100K, det_income_sixfig_cor_death$Deaths_per_HundThou, use = "complete.obs")
```
The correlation between a six figure income or more in Detroit and death rate is a correlation of 0.288.

Analyzing 30K and under income in Detroit.
```{r}
det_income_30K_below <- det_income %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("$25,000 to $29,999",
                      "$20,000 to $24,999",
                      "$15,000 to $19,999",
                      "$10,000 to $14,999",
                      "Less than $10,000")) %>% 
  mutate(prop_30K = sum(prop)) %>% 
  select(GEOID, prop_30K) %>% 
  distinct(GEOID, prop_30K)

lvls <- det_income_30K_below %>% 
  arrange(prop_30K) %>% 
  pull(GEOID)

det_income <- left_join(det_income, detroit_covid, by = c("GEOID" = "ZIP"))

ggplot(det_income) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))+
labs(title = "Income Status in past year per household for Each Detroit Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Income Status")
```

The scatterplot shows the correlation between families making 30K or less in Detroit and COVID cases. 
```{r}
det_income_30K_below_cor <- left_join(det_income_30K_below, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_income_30K_below_cor) +
  geom_point(aes(x = prop_30K, y = Cases_per_HundThou)) +
  labs(title = "Correlation Between Families Making 30K or Less and COVID Cases",
       x = "Proportion of Families Making 30K or Less",
       y = "Case Rate (per 100,000)")
```

Test correlation between families making 30K or less incomes to case rate of COVID.
```{r}
cor.test(det_income_30K_below_cor$prop_30K, det_income_30K_below_cor$Cases_per_HundThou, use = "complete.obs")
```
The correlation between families making 30K or less and case rate of COVID is -0.135.

The scatterplot shows the correlation between families making 30K or less in Detroit and COVID deaths.
```{r}
det_income_30K_below_cor_death <- left_join(det_income_30K_below, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_income_30K_below_cor_death) +
  geom_point(aes(x = prop_30K, y = Deaths_per_HundThou)) +
  labs(title = "Correlation Between Families Making 30K or Less and COVID Deaths",
       x = "Proportion of Families Making 30K or Less",
       y = "Death Rate (per 100,000)")
```

Test correlation between families making 30K or less incomes to death rate of COVID.
```{r}
cor.test(det_income_30K_below_cor_death$prop_30K, det_income_30K_below_cor_death$Deaths_per_HundThou, use = "complete.obs")
```
The correlation between families making 30K or less and death rate of COVID is -0.169.

## Race

```{r}
det_race <- get_acs(geography = "zcta",
                        table = "B02001") %>% 
  filter(GEOID %in% zip_code_det$zip,
         !variable %in% c("B02001_001"))
det_race <- left_join(det_race, variables_2018[, 1:2], by = "variable")
det_race$label <- as_factor(str_replace(det_race$label, ".*!!(.*)", "\\1"))
```

Analyzing Afican Americans in Detroit. 
```{r}
det_AA <- det_race %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("Black or African American alone")) %>% 
  mutate(prop_AA = sum(prop)) %>% 
  select(GEOID, prop_AA) %>% 
  distinct(GEOID, prop_AA)

lvls <- det_AA %>% 
  arrange(prop_AA) %>% 
  pull(GEOID)

det_race <- left_join(det_race, detroit_covid, by = c("GEOID" = "ZIP"))

ggplot(det_race) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Racial Status for Each Detroit Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Racial Status")

```

The scatterplot shows the correlation between being an African American in Detroit and COVID cases. 
```{r}
det_race_cor <- left_join(det_AA, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_race_cor) +
  geom_point(aes(x = prop_AA, y = Cases_per_HundThou)) +
  labs(title = "Correlation Between Being an African American in Detroit and COVID Cases",
       x = "Proportion of African Americans",
       y = "Case Rate (per 100,000)")
```

Test correlation between being an African American in Detroit and case rate of COVID.
```{r}
cor.test(det_race_cor$prop_AA, det_race_cor$Cases_per_HundThou, use = "complete.obs")
```
The correlation between being an African American in Detroit and case rate of COVID is -0.263.

The scatterplot shows the correlation between being an African American in Detroit and COVID deaths.
```{r}
det_race_cor_death <- left_join(det_AA, detroit_covid, by = c("GEOID" = "ZIP"))
ggplot(det_race_cor_death) +
  geom_point(aes(x = prop_AA, y = Deaths_per_HundThou)) +
  labs(title = "Correlation Between Being an African American in Detroit and COVID Deaths",
       x = "Proportion of African Americans",
       y = "Death Rate (per 100,000)")
```

Test correlation between being an African American in Detroit and death rate of COVID.
```{r}
cor.test(det_race_cor_death$prop_AA, det_race_cor_death$Deaths_per_HundThou, use = "complete.obs")
```
The correlation between being an African American in Detroit and death rate of COVID is 0.223.

## Gini Index

```{r}
minn_gini <- get_acs(geography = "zcta",
                        table = "B19083") %>% 
  filter(GEOID %in% zip_code_minn$zip)
minn_gini <- left_join(minn_gini, variables_2018[, 1:2], by = "variable")
minn_gini$label <- as_factor(str_replace(minn_gini$label, ".*!!(.*)", "\\1"))
```

Analyze Gini Index for Minneapolis.  The scatterplot shows the correlation between Gini Index and COVID.
```{r}
minn_gini <- left_join(minn_gini, minneapolis_covid, by = c("GEOID" = "ZIP"))
minn_gini <- filter(minn_gini, GEOID != '55450')

ggplot(minn_gini) +
  geom_point(aes(x = estimate, y = case_rate)) +
  labs(title = "Gini Index for Each Minneapolis Zip Code",
       x = "Gini Index",
       y = "Case Rate")

```

Test correlation between gini index and case rate of COVID
```{r}
cor.test(minn_gini$estimate, minn_gini$case_rate, use = "complete.obs")
```
The correlation between gini index and case rate is 0.059.  This is a low positive number with a p-value close to 1, so we can't conclude anything about gini index and COVID. 

## Insurance Coverage(Public VS. Private)

```{r}
minn_insurance <- get_acs(geography = "zcta",
                           table = "B18135") %>% 
  filter(GEOID %in% zip_code_minn$zip,
         !variable %in% c("B18135_023"))
minn_insurance <- left_join(minn_insurance, variables_2018[, 1:2], by = "variable")
minn_insurance$label <- as_factor(str_replace(minn_insurance$label, ".*!!(.*)", "\\1"))
```

Analyze private health insurance coverage
```{r}
minn_insurance_private <- minn_insurance %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("With private health insurance coverage")) %>% 
  mutate(prop_priv = sum(prop)) %>% 
  select(GEOID, prop_priv) %>% 
  distinct(GEOID, prop_priv)

lvls <- minn_insurance_private %>% 
  arrange(prop_priv) %>% 
  pull(GEOID)

minn_insurance <- left_join(minn_insurance, minneapolis_covid, by = c("GEOID" = "ZIP"))

ggplot(minn_insurance) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Insurance Coverage for Each Minneapolis Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Insurance Coverage")
```

The scatterplot shows the correlation between private health insurance and COVID.
```{r}
minn_private_cor <- left_join(minn_insurance_private, minneapolis_covid, by = c("GEOID" = "ZIP"))
ggplot(minn_private_cor) +
  geom_point(aes(x = prop_priv, y = case_rate)) +
  labs(title = "Correlation Between Private Health Insurance and COVID",
       x = "Proportion of People with Private Health Insurance",
       y = "Case Rate (per 100,000)")
```

Test correlation between percentage of population with private health insurance and case rate of COVID
```{r}
cor.test(minn_private_cor$prop_priv, minn_private_cor$case_rate, use = "complete.obs")
```
The correlation between private health insurance and case rate is -0.803.  This is a big negative correlation. People with private health insurance have been contracting less cases of COVID. 

Analyze public health insurance coverage
```{r}
minn_insurance_public <- minn_insurance %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("With public health coverage")) %>% 
  mutate(prop_public = sum(prop)) %>% 
  select(GEOID, prop_public) %>% 
  distinct(GEOID, prop_public)

lvls <- minn_insurance_public %>% 
  arrange(prop_public) %>% 
  pull(GEOID)

minn_insurance <- left_join(minn_insurance, minneapolis_covid, by = c("GEOID" = "ZIP"))

ggplot(minn_insurance) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Insurance Coverage for Each Minneapolis Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Insurance Coverage")
```

The scatterplot shows the correlation between public health insurance and COVID. 
```{r}
minn_public_cor <- left_join(minn_insurance_public, minneapolis_covid, by = c("GEOID" = "ZIP"))
ggplot(minn_public_cor) +
  geom_point(aes(x = prop_public, y = case_rate)) +
  labs(title = "Correlation Between Public Health Insurance and COVID",
       x = "Proportion of People with Public Health Insurance",
       y = "Case Rate (per 100,000)")
```

Test correlation between percentage of population with public health insurance and case rate of COVID
```{r}
cor.test(minn_public_cor$prop_public, minn_public_cor$case_rate, use = "complete.obs")
```
The correlation between public health insurance and case rate is 0.686.  This is a positive realtionship.  The people with public insurance have been contracting more cases of COVID. 

## Transportation to Work

```{r}
minn_transport <- get_acs(geography = "zcta",
                       table = "B08301") %>% 
  filter(GEOID %in% zip_code_minn$zip,
         !variable %in% c("B08301_010"))
minn_transport <- left_join(minn_transport, variables_2018[, 1:2], by = "variable")
minn_transport$label <- as_factor(str_replace(minn_transport$label, ".*!!(.*)", "\\1"))
```

Analyzing public transporation
```{r}
minn_transport_public <- minn_transport %>% 
  group_by(GEOID) %>% 
  mutate(n = sum(estimate),
         prop = estimate/n) %>% 
  filter(label %in% c("Public transportation (excluding taxicab)",
                      "Bus or trolley bus",
                      "Streetcar or trolley car (carro publico in Puerto Rico)",
                      "Subway or elevated",
                      "Railroad")) %>% 
  mutate(prop_pub = sum(prop)) %>% 
  select(GEOID, prop_pub) %>% 
  distinct(GEOID, prop_pub)

lvls <- minn_transport_public %>% 
  arrange(prop_pub) %>% 
  pull(GEOID)

minn_transport <- left_join(minn_transport, minneapolis_covid, by = c("GEOID" = "ZIP"))

ggplot(minn_transport) +
  geom_col(aes(factor(GEOID, levels = lvls), estimate, fill = label),
           position = "fill") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  labs(title = "Transportation Distribution for Each Minneapolis Zip Code",
       x = "Zip Code",
       y = "Proportion", 
       fill = "Transportation")
```

The scatterplot shows the correlation between public transportation and COVID.
```{r}
minn_trans_cor <- left_join(minn_transport_public, minneapolis_covid, by = c("GEOID" = "ZIP"))
ggplot(minn_trans_cor) +
  geom_point(aes(x = prop_pub, y = case_rate)) +
  labs(title = "Correlation Between Public Transportation and COVID",
       x = "Proportion of People Using Public Transportation",
       y = "Case Rate (per 100,000)")
```

Test the correlation between the percentage of the population using public transportation and case rate of COVID
```{r}
minn_trans_cor <- left_join(minn_transport_public, minneapolis_covid, by = c("GEOID"="ZIP"))
cor.test(minn_trans_cor$prop_pub, minn_trans_cor$case_rate, use = "complete.obs")
```
The correlation between public transportation and case rate is 0.549.  This is a positive relationship meaning people using public transportation are more likely to get COVID.  


## Conclusions
 