---
title: 'COVID-19: A Midwestern Reporting Project of WNIN and the University of Evansville'
author: "Chicago Service Worker Analysis"
date: "10/19/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

## Introduction

We answer two questions in this report: who is the Chicago service worker? and what demographics explain the COVID case rate in Chicago ZIP codes. We look at ZIP code level data in order to understand what the service worker looks like in Chicago. We also examine the available COVID data on a ZIP code level and run a statistical linear model to find the demographics that explain the variation we see from the COVID case rate. These demographics do not necessarily drive the COVID case rate, but they do help explain the differences we are seeing in the case rate from ZIP code to ZIP code. 

## Data Obtained

We obtained Chicago's most recent COVID-19 numbers of individuals tested and those who had confirmed cases on October 1 from the [Illinois Department of Public Health](https://www.dph.illinois.gov/covid19/covid19-statistics). We paired Chicago's COVID-19 numbers with the 5-year American Community Survey (ACS) data which was last published in 2018. When first investigating the survey data, we had an option between the most recent 1-year data or the more precise 5-year estimates. The 5-year data is from a larger sample which has less error attached to estimates as well as a higher reliability statistically. The downside is it's not as current as the 1-year data, because the most recent 5-year data from 2018 had been collected from January 2014 to December 2018. We used the 2018 estimates as they were released in December 2019. The next collection of 5-year data ending in 2019 is to be released December 2020. The data is different between the 1-year and 5-year estimates since they were collected in two different periods. A 5-year estimate will show a smooth curve while 1-year data demonstrates changes each year resulting in less appealing graphs. 

### Demographics

The tables we used are as follows:

1. B05003 - Sex by Age and Citizenship Status
    i. broken down into: prop_female, prop_over_18, prop_citizen, prop_female_over_18, prop_female_citizen, prop_over_18_citizen,
                         prop_female_over_18_citizen
                         
2. B01001I - Sex by Age (Hispanic or Latino)
    i. broken down into: zip_pop_hisp, prop_female_hisp, prop_18_to_34_hisp, prop_female_18_to_34_hisp
    
3. B27001 - Health Insurance Coverage Status by Sex by Age
    i. broken down into: prop_female, prop_19_to_34, prop_with_HI, prop_female_19_to_34, prop_female_with_HI, prop_19_to_34_with_HI,
                                      prop_female_19_to_34_with_HI
                                      
4. B03002 - Race (Hispanic or Latino)
    i. broken down into: prop_not_His, prop_White, prop_not_His_White
    
5. C24030 - Sex by Industry
    i. broken down into: zip_pop_work_eligible, prop_male_work_eligible, prop_service, prop_male_work_eligible_service
    
6. B01001 - Sex by Age
    i. broken down into: prop_female, prop_18_to_34, prop_female_18_to_34
    
7. B27010 - Health Insurance by Type
    i. broken down into: prop_one_policy, prop_employer, prop_medicaid, prop_19_to_34_one_policy, prop_19_to_34_no_HI, prop_19_to_34_employer,
                         prop_19_to_34_medicaid

## Who is a Chicago Service Worker?

Timmy's section. (Timmy, be sure to include a simply interpretation of who the service worker is along as well as what professions we defined as being a service worker, along with the graphic)

As we performed this analysis, much of our focus was on the typical characteristics of the service worker in Chicago. We used correlation analyses, where we compared how strongly correlated one demographic value is with the proportion of service workers for each ZIP code. Correlations are measured from -1 to 1, where a correlation of -1 means that as one variable increases, the other variable decreases. A correlation of 1 means that as one variable increases, the other variable increases. The table below shows the correlations to the proportion of service workers (prop_service) for each demographic characteristic that we analyzed. Here are a couple examples of how to read this table: the correlation between the proportion of service workers (prop_service) and the proportion of people with health insurance is -.8965770. This means that as the proportion of service workers in a ZIP code increases, the proportion of people with health insurance decreases. Futher down the table, we see a correlation value of 0.76046345 for the correlation between the proportion of service workers (prop_service) and the proportion of individuals with Medicaid (prop_medicaid). This means that as the proportion of service workers in a ZIP code increases, the proportion of people with Medicaid (as opposed to other kinds of health insurance policies) increases. The table is ordered by the magnitude of the correlation, meaning that the strongest correlations, regardless of whether they are positive or negative, are listed at the top.

```{r}
#one row correlation matrix
library(tidyverse)
library(tidycensus)
library(reshape2)
library(ggcorrplot)
library(data.table)
chicago_master <- read_csv("../Data/chicago_master_for_service_model.csv")
yyy<-cor(x=chicago_master, y=chicago_master$prop_service)
yyy<-as.data.frame(yyy, col.names=c("Variable", "Correlation Coefficient"))
orc<-yyy%>%subset(V1>=.7 |V1<= -.7)
orc<-orc%>%subset(V1!=1)
orc<-setDT(orc, keep.rownames = TRUE)
orc<-orc %>% arrange(desc(abs(V1)))
orc<-orc%>%rename(Variable=rn, Correlation.Coefficient=V1 )
print(orc)

```

## What Demographics Explain the COVID Case Rate?

For our model we went with a linear regression model and we used a shrinkage technique to be able to identify the variables that did the best job in explaining the variation that we see in the COVID case rate. Based off the many models we ran, it looks as though the proportion of 18 to 34 year olds that are Hispanic/Latino and the proportion of non-Hispanic/Latinos do the best at explaining the variation we see in the COVID case rate. As the proportion of Hispanics/Latinos between 18 and 34 goes up, the rate of COVID goes down. Interestingly enough, we also see that as the proportion of non-Hispanic/Latinos goes up, the case rate goes down at a faster rate. So it appears that the 18 to 34 demographic really drives COVID case rates down even though the Hispanic demographic is seeing an increase in their COVID case rate. These other variables also saw a decrease in COVID case rate as their proportion increased: the proportion of work eligible people, the proportion of citizens over 18 and the proportion of the population that is not Hispanic or latino and is white. There were two variables that we saw that as the proportion increased, the COVID case rate also increased, and those were; the proportion of the population that is hispanic, and the proportion of females that were aged 19 to 34. In all, while building a model that tries to explain the relationship between the COVID case rate between all 34 predictor variables that we had, there were 7 that did the most to explain that relationship. Those 7 being: the proportion of the population that is hispanic, the proportion that is work eligible, the proportion of citizens over 18, the proportion of 18 to 34 year olds that are hispanic, the proportions of 19 to 34 year olds that are female, the proportion that is not hispanic, and the proportion that is not hispanic but white. 

The math equation for the model is represented as: INSERT EQUATION
For example: A 0.1 increase in the proportion of 18 to 34 year old Hispanics/Latinos will correspond to a decrease of 133 per 100,000 in the COVID case rate. Contrast this with the fact that a 0.1 increase in the proportion of Hispanic/Latinos (not 18 to 34) will correspond to an increase in the case rate of 255 per 100,000. It seems we have an almost 400 cases per 100,000 swing just by focusing on the 18 to 34 age range. Looking at a far less significant variable, the proportion of the population that is Hispanic (note this was a positive correlation), a .1 increase in the proportion does not even increase the case rate by 1 person per 100,000. 
